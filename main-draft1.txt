package main

import (
	"github.com/gin-gonic/gin"
  // "github.com/joho/godotenv"
	"net/http"
  "log"
  "os"
  "fmt"
  "github.com/Go-Todo/Config"
  "database/sql"
)

// type Todo struct {
	// ID        uint   `json:"id"`
	// Title     string `json:"title"`
	// Completed bool   `json:"completed"`
// }

// func init() { // for loading environment variable
  // err := godotenv.Load()
  // if err != nil {
    // log.Fatalf("Error loading .env file")
  // }
  // this reads PORT environment vairable and it runs on port 3000
  // return;
// }

func main() {
  db, err := sql.Open("mysql", Config.DBUri(Config.BuildDBConfig()))
	if err != nil {
    log.Fatal(err)
	}
  err = db.Ping()
  if err != nil {
    log.Fatal(err)
  } else {
    fmt.Println("DB connected")
  }


	defer db.Close()

  // this is to create a new gin engine
	r := gin.Default()
  os.Getenv("PORT")

  // test the server
  // http://localhost:8080/ping
  r.GET("/ping", func(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
      "message": "pong",
    })
  })


  // this is to start the server
	r.Run()
}
